import{ref as e,onMounted as t,onBeforeUnmount as o,watch as n,computed as r,unref as a,isRef as l,defineComponent as i,toRef as c,mergeProps as s}from"vue";import{a as u,u as d,b as m}from"./useStateful.js";import{a as p}from"./debounce.js";import{i as v}from"./ssr-utils.js";import{ssrRenderAttrs as h,ssrRenderSlot as f,ssrRenderTeleport as y}from"@vue/server-renderer";const useDomRect=r=>{const a=e(null);let l=null;const observe=()=>{null==l||l(),r.value?l=((e,t)=>{let o,n=-1;const r=["x","y","width","height","top","left","bottom","right"],observe=()=>{n=requestAnimationFrame(observe);const a=e.getBoundingClientRect();if(!o)return t(a),void(o=a);r.some((e=>a[e]!==o[e]))&&(t(a),o=a)};return observe(),()=>{cancelAnimationFrame(n)}})(r.value,(e=>{a.value=e})):a.value=null};return t((()=>{observe()})),o((()=>{null==l||l()})),n(r,(()=>{observe()})),{domRect:a}},mapObject=(e,t)=>{const o={};return Object.keys(e).forEach((n=>{o[n]=t(e[n],n)})),o},g=["top","bottom","left","right"].reduce(((e,t)=>[...e,t,`${t}-start`,`${t}-end`,`${t}-center`]),["auto"]),coordsToCss=({x:e,y:t})=>({left:`${e}px`,top:`${t}px`}),parsePlacement=e=>{const[t,o]=e.split("-");return{position:t,align:o||"center"}},calculateContentAlignment=(e,t,o,n)=>"start"===e?t:"end"===e?t+o-n:t+(o-n)/2,calculateContentCoords=(e,t,o)=>{const{position:n,align:r}=parsePlacement(e),a=calculateContentAlignment(r,t.left,t.width,o.width),l=calculateContentAlignment(r,t.top,t.height,o.height);switch(n){case"top":return{x:a,y:t.top-o.height};case"left":return{y:l,x:t.left-o.width};case"right":return{y:l,x:t.right};case"bottom":default:return{x:a,y:t.bottom}}},calculateOffsetCoords=(e,t)=>{const{position:o}=parsePlacement(e),{main:n,cross:r}=(e=>Array.isArray(e)?{main:e[0],cross:e[1]}:{main:e,cross:0})(t);switch(o){case"left":return{y:r,x:-n};case"right":return{y:r,x:n};case"top":return{y:-n,x:r};case"bottom":default:return{y:n,x:r}}},calculateContentOverflow=(e,t,o)=>{const n=o.right,r=o.bottom,a=o.left,l=o.top;return{top:Math.max(l-e.y,0),bottom:Math.max(e.y+t.height-r,0),left:Math.max(a-e.x,0),right:Math.max(e.x+t.width-n,0)}},clamp=(e,t,o)=>Math.max(Math.min(t,o),e),usePopover=(l,i,c)=>{const s=(o=>{if(v()){const n=e(null);return t((()=>{n.value=o()})),n}return e(o())})((()=>document)),u=r((()=>{if(!s.value)return;const{root:e}=a(c);return e?s.value.querySelector(e):s.value.body})),{domRect:d}=useDomRect(l),{domRect:m}=useDomRect(i),updateContentCSS=()=>{var e;if(!u.value||!d.value||!m.value)return;let t={x:0,y:0};const o={width:"max-content",position:"fixed"},{placement:n,keepAnchorWidth:r,offset:l,autoPlacement:s,stickToEdges:p}=a(c);let v=calculateContentCoords(n,d.value,m.value);if(l&&(t=calculateOffsetCoords(n,l),v=mapObject(v,((e,o)=>e+t[o]))),r){const{width:e}=d.value;Object.assign(o,{width:`${e}px`,maxWidth:`${e}px`})}const h=u.value.getBoundingClientRect();if(s){const e=((e,t,o,n)=>{const{position:r,align:a}=parsePlacement(e),l=calculateContentOverflow(t,o,n),i={top:["bottom",a].join("-"),bottom:["top",a].join("-"),right:["left",a].join("-"),left:["right",a].join("-")};return l[r]?i[r]:e})(n,v,m.value,h);e!==n&&(v=calculateContentCoords(e,d.value,m.value),l&&(t=calculateOffsetCoords(e,l),v=mapObject(v,((e,o)=>e+t[o]))))}p&&(v=((e,t,o,n,r)=>{const{top:a,bottom:l,left:i,right:c}=calculateContentOverflow(e,o,r),s=e.x-c+i,u=e.y-l+a,{x:d,y:m}=t;return{x:clamp(n.left+d-o.width,s,n.right+d),y:clamp(n.top+m-o.height,u,n.bottom+m)}})(v,t,m.value,d.value,h)),Object.assign(null===(e=i.value)||void 0===e?void 0:e.style,{...o,...coordsToCss(v)})};return n(d,updateContentCSS),n(m,updateContentCSS),n(c,updateContentCSS,{deep:!0}),t((()=>{window.addEventListener("resize",updateContentCSS)})),o((()=>{window.removeEventListener("resize",updateContentCSS)})),{anchorDomRect:d,contentDomRect:m}},useDebounceFn=e=>{let t=null;const createDebounced=()=>p((()=>{null==t||t(),t=null}),a(e));let o=createDebounced();return l(e)&&n(e,(()=>{o=createDebounced()})),{debounced:e=>{t=e,o()},cancel:()=>o.cancel()}},checkIfElementChild=(e,t)=>!!t&&(t.parentElement===e||checkIfElementChild(e,t.parentElement)),useClickOutside=(e,n)=>{const clickHandler=t=>{const o=t.target;var r;(r=e,Array.isArray(r)?r:[r]).some((e=>a(e)&&checkIfElementChild(a(e),o)))||n(o)};t((()=>{window.addEventListener("click",clickHandler)})),o((()=>{window.removeEventListener("click",clickHandler)}))};var b=i({name:"VaDropdown",props:{...u,stateful:{default:!0},modelValue:{type:Boolean,default:!1},disabled:{type:Boolean},anchorSelector:{type:String,default:""},attachElement:{type:String,default:"body"},disableAttachment:{type:Boolean,default:!1},keepAnchorWidth:{type:Boolean,default:!1},isContentHoverable:{type:Boolean,default:!0},closeOnContentClick:{type:Boolean,default:!0},closeOnClickOutside:{type:Boolean,default:!0},closeOnAnchorClick:{type:Boolean,default:!0},hoverOverTimeout:{type:Number,default:30},hoverOutTimeout:{type:Number,default:200},offset:{type:[Array,Number],default:()=>0},trigger:{type:String,default:"click",validator:e=>["click","hover","none"].includes(e)},placement:{type:String,default:"bottom",validator:e=>g.includes(e)}},emits:[...d,"anchor-click","dropdown-content-click","click-outside"],setup(t,{emit:o}){const n=e(),a=e(),{valueComputed:l}=m(t,o),i=r((()=>({"va-dropdown":!0,"va-dropdown--disabled":t.disabled}))),s=r((()=>n.value&&t.anchorSelector&&n.value.querySelector(t.anchorSelector)||n.value));usePopover(s,a,r((()=>({placement:t.placement,keepAnchorWidth:t.keepAnchorWidth,offset:t.offset,stickToEdges:!0,autoPlacement:!0,root:t.attachElement}))));const{debounced:u,cancel:d}=useDebounceFn(c(t,"hoverOverTimeout")),{debounced:p,cancel:v}=useDebounceFn(c(t,"hoverOutTimeout")),emitAndClose=(e,t)=>{o(e),t&&(l.value=!1)};return useClickOutside([n,a],(()=>{t.closeOnClickOutside&&l.value&&emitAndClose("click-outside",t.closeOnClickOutside)})),{valueComputed:l,anchorRef:n,contentRef:a,computedClass:i,emitAndClose:emitAndClose,onAnchorClick:()=>{"click"!==t.trigger||t.disabled||(l.value?emitAndClose("anchor-click",t.closeOnAnchorClick):(l.value=!0,o("anchor-click")))},onMouseEnter:()=>{"hover"!==t.trigger||t.disabled||(u((()=>{l.value=!0})),v())},onMouseLeave:()=>{"hover"!==t.trigger||t.disabled||(t.isContentHoverable?p((()=>{l.value=!1})):l.value=!1,d())}}}});b.ssrRender=function ssrRender(e,t,o,n,r,a,l,i){t(`<div${h(s({class:["va-dropdown",e.computedClass]},n))}><div class="va-dropdown__anchor">`),f(e.$slots,"anchor",{},null,t,o),t("</div>"),e.valueComputed?y(t,(t=>{t('<div class="va-dropdown__content-wrapper">'),f(e.$slots,"default",{},null,t,o),t("</div>")}),e.attachElement,e.disableAttachment,o):t("\x3c!----\x3e"),t("</div>")},b.__file="src/components/va-dropdown/VaDropdown.vue";export{g as p,b as s};
//# sourceMappingURL=VaDropdown.js.map
