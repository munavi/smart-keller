import{w as e}from"./withConfigTransport.js";import{defineComponent as t,ref as o,computed as s,onMounted as n,resolveComponent as a,mergeProps as l,createVNode as r,render as i}from"vue";import{u as p}from"./color-config.js";import{u as c}from"./useTextColor.js";import{s as u}from"./VaIcon.js";import{ssrRenderAttrs as d,ssrInterpolate as f,ssrRenderStyle as v,ssrRenderComponent as m}from"@vue/server-renderer";import{g}from"./ssr-utils.js";import{defineVuesticPlugin as y}from"./index56.js";import{defineGlobalProperty as C}from"./global-properties.js";const T=t({name:"VaToastRenderer",props:{render:{type:Function,required:!0}},setup:e=>()=>e.render()});var x=t({name:"VaToast",components:{VaIcon:u,VaToastRenderer:T},emits:["on-click","on-close"],props:{title:{type:String,default:""},offsetY:{type:Number,default:16},offsetX:{type:Number,default:16},message:{type:[String,Function],default:""},dangerouslyUseHtmlString:{type:Boolean,default:!1},icon:{type:String,default:"close"},customClass:{type:String,default:""},duration:{type:Number,default:5e3},color:{type:String,default:""},closeable:{type:Boolean,default:!0},onClose:{type:Function},onClick:{type:Function},multiLine:{type:Boolean,default:!1},position:{type:String,default:"top-right",validator:e=>["top-right","top-left","bottom-right","bottom-left"].includes(e)},render:{type:Function}},setup(e,{emit:t}){const{getColor:a}=p(),{textColorComputed:l}=c(e.color),r=o(),i=o(!1),u=s((()=>e.position.includes("right")?"right":"left")),d=s((()=>e.position.includes("top")?"top":"bottom")),f=s((()=>[e.customClass,e.multiLine?"va-toast--multiline":""])),v=s((()=>({[d.value]:`${e.offsetY}px`,[u.value]:`${e.offsetX}px`,backgroundColor:a(e.color),color:l.value}))),m=s((()=>"function"==typeof e.message?e.message():e.message)),destroyElement=()=>{var e,t;null===(e=r.value)||void 0===e||e.removeEventListener("transitionend",destroyElement),null===(t=r.value)||void 0===t||t.remove()},onToastClose=()=>{var o;i.value=!1,null===(o=r.value)||void 0===o||o.addEventListener("transitionend",destroyElement),"function"==typeof e.onClose?e.onClose():t("on-close")},g=(()=>{let e;return{start:(...t)=>(e=setTimeout(...t),e),clear:()=>e&&clearTimeout(e)}})(),y=g.clear,startTimer=()=>{e.duration>0&&g.start((()=>i.value&&onToastClose()),e.duration)};return n((()=>{i.value=!0,startTimer()})),{visible:i,toastClasses:f,toastStyles:v,computedMessage:m,onToastClick:()=>{"function"==typeof e.onClick?e.onClick():t("on-click")},onToastClose:onToastClose,startTimer:startTimer,clearTimer:y}}});x.ssrRender=function ssrRender(e,t,o,s,n,r,i,p){const c=a("VaToastRenderer"),u=a("va-icon");t(`<div${d(l({style:[e.visible?null:{display:"none"},e.toastStyles],class:["va-toast",...e.toastClasses],role:"alert",ref:"rootElement"},s))}><div class="va-toast__group">`),e.$props.title?t(`<h2 class="va-toast__title">${f(e.$props.title)}</h2>`):t("\x3c!----\x3e"),t(`<div class="va-toast__content" style="${v(e.$props.message?null:{display:"none"})}">`),e.$props.dangerouslyUseHtmlString?t(`<div>${e.computedMessage}</div>`):t(`<p>${f(e.computedMessage)}</p>`),t("</div>"),e.$props.render?(t('<div class="va-toast__content">'),t(m(c,{render:e.$props.render},null,o)),t("</div>")):t("\x3c!----\x3e"),e.$props.closeable?t(m(u,{size:"small",name:e.$props.icon,class:"va-toast__close-icon"},null,o)):t("\x3c!----\x3e"),t("</div></div>")},x.__file="src/components/va-toast/VaToast.vue";var h=e(x);let $=1;g().vaToastInstances=[];const getNodeProps=e=>{var t;return(null===(t=e.component)||void 0===t?void 0:t.props)||{}},closeNotification=(e,t)=>{var o;if(!e)return;if(!g().vaToastInstances.length)return void($=1);const s=g().vaToastInstances.findIndex((t=>t===e));if(s<0)return;const n=getNodeProps(e),{offsetX:a,offsetY:l,position:r}=n,i=null===(o=e.el)||void 0===o?void 0:o.offsetHeight;t(),g().vaToastInstances=g().vaToastInstances.reduce(((t,o,n)=>{if(o===e)return t;if(o.component){const{offsetX:e,offsetY:t,position:p}=getNodeProps(o);if(n>s&&a===e&&l===t&&r===p&&o.el&&i){const[e,t]=o.el.style.transform.match(/[\d-]+(?=px)/g),s=((e,t,o)=>{const s=o.includes("bottom")?-1:1;return parseInt(e,10)-(t+5)*s})(t,i,p);o.el.style.transform=`translate(0, ${s}px)`}}return[...t,o]}),[]),g().vaToastInstances.length||($=1)},mount=(e,{props:t,children:o,element:s,appContext:n}={})=>{let a,l=s;return a=r(e,{...t,onClose:()=>{closeNotification(a,(()=>((e,t)=>{e&&(i(null,e),e.remove()),e=null})(l))),(null==t?void 0:t.onClose)&&t.onClose()}},o),n&&(a.appContext=n),l?i(a,l):"undefined"!=typeof document&&i(a,l=document.createElement("div")),{vNode:a,el:l}},closeAllNotifications=e=>{g().vaToastInstances.length?g().vaToastInstances.forEach((t=>{e&&t.appContext!==e||getNodeProps(t).onClose()})):$=1},closeById=e=>{const t=g().vaToastInstances.find((t=>{var o;return(null===(o=t.el)||void 0===o?void 0:o.id)===e}));if(t){getNodeProps(t).onClose()}},createToastInstance=(e,t)=>{const{vNode:o,el:s}=mount(h,{appContext:t,props:(n=e,"string"==typeof n?{message:n}:n)});var n;const a=getNodeProps(o);if(s&&o.el&&a){document.body.appendChild(s.childNodes[0]);const{offsetX:e,offsetY:t,position:n}=a;o.el.style.display="flex",o.el.id="notification_"+$;let l=0;return g().vaToastInstances.filter((o=>{const{offsetX:s,offsetY:a,position:l}=getNodeProps(o);return s===e&&a===t&&n===l})).forEach((e=>{l+=((e,t)=>{if(e.el){const o=t.includes("bottom")?-1:1;return(e.el.offsetHeight+5)*o}return 0})(e,n)})),o.el.style.transform=`translate(0, ${l}px)`,$+=1,g().vaToastInstances.push(o),o.el.id}return null},b=y((()=>({install(e){C(e,"$vaToast",(e=>({init:t=>createToastInstance(t,null==e?void 0:e._context),close(e){closeById(e)},closeAll(t=!1){closeAllNotifications(t||null==e?void 0:e._context)}}))(e))}}))),I={closeDropdown(){let e=this;for(;e=e.$parent;){if("VaDropdown"===e.$options.name){e.hide();break}}}},_=y((()=>({install(e){C(e,"$closeDropdown",I.closeDropdown),C(e,"$vaDropdown",I)}})));export{b as V,closeById as a,closeAllNotifications as b,createToastInstance as c,_ as d};
//# sourceMappingURL=index65.js.map
