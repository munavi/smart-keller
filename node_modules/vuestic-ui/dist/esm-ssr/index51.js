import{w as e}from"./withConfigTransport.js";import{a as l}from"./debounce.js";import{onMounted as r,onBeforeUnmount as o,defineComponent as i,ref as s,computed as n,watch as t,resolveComponent as a,createVNode as v,resolveDynamicComponent as u,mergeProps as c,withCtx as d,renderSlot as p,createCommentVNode as f}from"vue";import{s as m}from"./utils.js";import{a as g}from"./useColor.js";import{VaProgressCircle as _}from"./index39.js";import{ssrRenderVNode as b,ssrRenderSlot as h,ssrRenderClass as y,ssrRenderComponent as S}from"@vue/server-renderer";import"./VaConfig.js";import"./global-config.js";import"./toNumber.js";import"./isSymbol.js";import"./color-config.js";import"colortranslator";import"./clamp.js";import"./useSize.js";var j=i({name:"VaInfiniteScroll",components:{VaProgressCircle:_},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:String,default:null},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:i}){const a=s(),v=s(),u=s(!1),c=s(!1),d=s(!1),p=s(),f=s(0),_=s(0),b=n((()=>{var l;let r;return r="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(l=a.value)||void 0===l?void 0:l.parentElement),r||document.body})),{addScrollListener:h,removeScrollListener:y}=((e,l,i)=>{const addScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.addEventListener("scroll",i.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.removeEventListener("scroll",i.value)};return r((()=>{l.value&&(l.value.style.overflowY="scroll",e.reverse&&(l.value.scrollTop=l.value.scrollHeight),addScrollListener())})),o(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,b,p),{computeColor:S}=g(e),j=n((()=>c.value?S("danger"):S("primary"))),$=n((()=>{var e;return(null===(e=v.value)||void 0===e?void 0:e.offsetHeight)||0})),C=n((()=>e.offset+$.value)),stop=()=>{e.disabled||(u.value=!1,y())},resume=()=>{e.disabled||h()},onLoad=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=b.value;f.value=r-l;const i=l-_.value;if(_.value=l,e.disabled||c.value||u.value)return;if(d.value)return void(d.value=!1);if(e.reverse&&i>0||!e.reverse&&i<0)return;(e.reverse?l:r-l-o)>C.value||(u.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{d.value=!0,b.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=b.value;if(e.reverse){const e=r-l<f.value,o=l>=$.value;if(e&&o)return;r-f.value>$.value?forceSetScrollTopToTarget(r-f.value):forceSetScrollTopToTarget($.value)}if(!e.reverse){!(r-l-o>=$.value)&&forceSetScrollTopToTarget(r-o-$.value)}},finishLoading=()=>{updateTargetElementScrollTop(),u.value=!1,i("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),d.value=!1,c.value=!1,u.value=!1,i("onerror")},onError=()=>{stop(),c.value=!0,m(1200).then(stopErrorDisplay).then(resume)};return t((()=>e.debounce),(e=>{p.value=l(onLoad,e)}),{immediate:!0}),t((()=>e.disabled),(e=>{e?stop():resume()})),{element:a,spinnerSlotContainer:v,spinnerColor:j,fetching:u}}});j.ssrRender=function ssrRender(e,l,r,o,i,s,n,t){const m=a("va-progress-circle");b(l,v(u(e.$props.tag),c({class:["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}],ref:"element"},o),{default:d(((l,r,o,i)=>{if(!r)return[p(e.$slots,"default"),v("div",{class:["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}],ref:"spinnerSlotContainer"},[e.$props.disabled?f("v-if",!0):p(e.$slots,"loading",{key:0},(()=>[v("div",{class:"va-infinite-scroll__spinner__default"},[v(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)];h(e.$slots,"default",{},null,r,o,i),r(`<div class="${y([{"va-infinite-scroll__spinner--invisible":!e.fetching},"va-infinite-scroll__spinner"])}"${i}>`),e.$props.disabled?r("\x3c!----\x3e"):h(e.$slots,"loading",{},(()=>{r(`<div class="va-infinite-scroll__spinner__default"${i}>`),r(S(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,o,i)),r("</div>")}),r,o,i),r("</div>")})),_:3}),r)},j.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";var $=e(j);export{$ as default};
//# sourceMappingURL=index51.js.map
