import{toRefs as e,ref as t,watch as a,computed as l,defineComponent as u,onMounted as r,nextTick as s,mergeProps as i,resolveComponent as o}from"vue";import{u as n}from"./useSyncProp.js";import{a as v,u as m}from"./useFocus.js";import{ssrRenderAttrs as c,ssrRenderList as d,ssrRenderClass as p,ssrRenderSlot as f,ssrInterpolate as I,ssrRenderComponent as h}from"@vue/server-renderer";import{a as x,u as k,b as y}from"./useStateful.js";import{u as b,a as g}from"./useForm.js";import{u as F}from"./useArrayRefs.js";const safeModelValue=e=>e.value?e.value:new Date((new Date).setHours(0,0,0,0)),createNumbersArray=e=>Array.from(Array(e).keys()),from24to12=e=>(0===e?12:e)-12*Number(e>12),createHoursColumn=(e,t,a)=>{const u=l((()=>e.ampm?12:24)),r=l((()=>{let t=createNumbersArray(u.value);return e.hoursFilter&&(t=t.filter((t=>e.hoursFilter(e.ampm?t+12*Number(a.value):t)))),t.map((t=>e.ampm?from24to12(t):t))})),s=l({get:()=>{if(!t.value)return-1;if(e.ampm){const e=from24to12(t.value.getHours()-12*Number(a.value));return r.value.findIndex((t=>t===e))}const l=t.value.getHours();return r.value.findIndex((e=>e===l))},set:l=>{if(e.readonly)return;const u=e.ampm?((e,t=!1)=>(12===e?0:e)+12*Number(t))(r.value[l],a.value):r.value[l];t.value=new Date(safeModelValue(t).setHours(u))}});return l((()=>({items:r.value,activeItem:s})))},useTimePicker=(u,r)=>{const{view:s}=e(u),i=t(!1);a(r,(()=>{i.value=safeModelValue(r).getHours()>=12}),{immediate:!0});const o=createHoursColumn(u,r,i),n=((e,t)=>{const a=l((()=>{const t=createNumbersArray(60);return e.minutesFilter?t.filter(e.minutesFilter):t})),u=l({get:()=>{if(!t.value)return-1;const e=t.value.getMinutes();return a.value.findIndex((t=>t===e))},set:l=>{if(e.readonly)return;const u=a.value[l];t.value=new Date(safeModelValue(t).setMinutes(u))}});return l((()=>({items:a.value,activeItem:u})))})(u,r),v=((e,t)=>{const a=l((()=>{const t=createNumbersArray(60);return e.secondsFilter?t.filter(e.secondsFilter):t})),u=l({get:()=>{if(!t.value)return-1;const e=t.value.getSeconds();return a.value.findIndex((t=>t===e))},set:l=>{if(e.readonly)return;const u=a.value[l];t.value=new Date(safeModelValue(t).setSeconds(u))}});return l((()=>({items:a.value,activeItem:u})))})(u,r),m=((e,t,a)=>l((()=>({items:["AM","PM"],activeItem:l({get:()=>t.value?Number(a.value):-1,set:l=>{a.value=Boolean(l);const u=safeModelValue(t).getHours();let r=a.value?u+12:u;a.value&&u<=12&&(r=u+12),!a.value&&u>=12&&(r=u-12);const s=!e.hoursFilter||e.hoursFilter(r);e.periodUpdatesModelValue&&s&&(t.value=new Date(safeModelValue(t).setHours(r)))}})}))))(u,r,i);return{columns:l((()=>{const e=[];return"hours"===s.value?e.push(o.value):"minutes"===s.value?e.push(o.value,n.value):"seconds"===s.value&&e.push(o.value,n.value,v.value),u.ampm&&!u.hidePeriodSwitch&&e.push(m.value),e})),isPM:i}};var C=u({name:"VaTimePickerColumn",props:{items:{type:Array,default:()=>[]},activeItemIndex:{type:Number,default:0}},emits:["item-selected","update:activeItemIndex",...v],setup(e,{emit:l}){const u=t();m(u,l);const[i]=n("activeItemIndex",e,l);a(i,(e=>{scrollTo(e)})),r((()=>scrollTo(i.value,!1)));const scrollTo=(e,t=!0)=>{s((()=>{var a,l;const r=u.value.children[e];r?null===(l=u.value)||void 0===l||l.scrollTo({behavior:t?"smooth":"auto",top:r.offsetTop-r.parentElement.offsetTop}):null===(a=u.value)||void 0===a||a.scrollTo({behavior:t?"smooth":"auto",top:0})}))};return{rootElement:u,makeActiveNext:t=>{i.value=(i.value+(t||1))%e.items.length,s((()=>scrollTo(i.value)))},makeActivePrev:t=>{i.value=(i.value-(t||1)+e.items.length)%e.items.length,s((()=>scrollTo(i.value)))},makeActiveByIndex:e=>{i.value=e,s((()=>scrollTo(i.value)))},onCellClick:e=>{i.value=e},formatCell:e=>Number.isInteger(e)?e<10?`0${e}`:`${e}`:e}},methods:{focus(){var e;null===(e=this.rootElement)||void 0===e||e.focus()},blur(){var e;null===(e=this.rootElement)||void 0===e||e.blur()}}});C.ssrRender=function ssrRender$1(e,t,a,l,u,r,s,o){t(`<div${c(i({tabindex:"0",class:"va-time-picker-column",ref:"rootElement"},l))}><div class="va-time-picker-cell va-time-picker-cell--fake"></div>\x3c!--[--\x3e`),d(e.items,((l,u)=>{t(`<div class="${p({"va-time-picker-cell":!0,"va-time-picker-cell--active":u===e.$props.activeItemIndex})}">`),f(e.$slots,"cell",{item:l,index:u,activeItemIndex:e.activeItemIndex,items:e.items,formattedItem:e.formatCell(l)},(()=>{t(`${I(e.formatCell(l))}`)}),t,a),t("</div>")})),t('\x3c!--]--\x3e<div class="va-time-picker-cell va-time-picker-cell--fake"></div></div>')},C.__file="src/components/va-time-picker/components/VaTimePickerColumn.vue";var P=u({name:"VaTimePicker",components:{VaTimePickerColumn:C},props:{...x,...b,modelValue:{type:Date,required:!1},ampm:{type:Boolean,default:!1},hidePeriodSwitch:{type:Boolean,default:!1},periodUpdatesModelValue:{type:Boolean,default:!0},view:{type:String,default:"minutes"},hoursFilter:{type:Function},minutesFilter:{type:Function},secondsFilter:{type:Function}},emits:k,setup(e,{emit:a}){const{valueComputed:l}=y(e,a),{columns:u,isPM:r}=useTimePicker(e,l),{setItemRef:s,itemRefs:i}=F(),o=t(),focus=(e=0)=>{var t;null===(t=i.value[e])||void 0===t||t.focus()},{createComputedClass:n}=g(e);return{columns:u,computedClass:n("va-time-picker"),isPM:r,pickers:i,setItemRef:s,focusNext:()=>{const e=((null==o?void 0:o.value)||0)+1;o.value=e%u.value.length,focus(o.value)},focusPrev:()=>{const e=((null==o?void 0:o.value)||0)-1+u.value.length;o.value=e%u.value.length,focus(o.value)},activeColumnIndex:o,focus:focus,blur:e=>{var t;e?null===(t=i.value[e])||void 0===t||t.blur():i.value.forEach((e=>null==e?void 0:e.blur()))}}}});P.ssrRender=function ssrRender(e,t,a,l,u,r,s,n){const v=o("VaTimePickerColumn");t(`<div${c(i({class:["va-time-picker",e.computedClass]},l))}>\x3c!--[--\x3e`),d(e.columns,((l,u)=>{t(h(v,{key:u,ref:e.setItemRef,items:l.items,tabindex:e.disabled?-1:0,activeItemIndex:l.activeItem.value,"onUpdate:activeItemIndex":e=>l.activeItem.value=e},null,a))})),t("\x3c!--]--\x3e</div>")},P.__file="src/components/va-time-picker/VaTimePicker.vue";export{P as s};
//# sourceMappingURL=VaTimePicker.js.map
