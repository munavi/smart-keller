import{ref as e,onMounted as t,onBeforeUnmount as o,watch as n,computed as r,unref as l,isRef as a,defineComponent as c,toRef as i,openBlock as s,createElementBlock as u,normalizeClass as d,createElementVNode as p,withKeys as m,withModifiers as h,renderSlot as v,createBlock as f,Teleport as y,createCommentVNode as g}from"vue";import{a as b,u as k,b as w}from"./useStateful.mjs";import{a as x}from"./debounce.mjs";import{i as C}from"./ssr-utils.mjs";const useDomRect=r=>{const l=e(null);let a=null;const observe=()=>{null==a||a(),r.value?a=((e,t)=>{let o,n=-1;const r=["x","y","width","height","top","left","bottom","right"],observe=()=>{n=requestAnimationFrame(observe);const l=e.getBoundingClientRect();if(!o)return t(l),void(o=l);r.some((e=>l[e]!==o[e]))&&(t(l),o=l)};return observe(),()=>{cancelAnimationFrame(n)}})(r.value,(e=>{l.value=e})):l.value=null};return t((()=>{observe()})),o((()=>{null==a||a()})),n(r,(()=>{observe()})),{domRect:l}},mapObject=(e,t)=>{const o={};return Object.keys(e).forEach((n=>{o[n]=t(e[n],n)})),o},A=["top","bottom","left","right"].reduce(((e,t)=>[...e,t,`${t}-start`,`${t}-end`,`${t}-center`]),["auto"]),coordsToCss=({x:e,y:t})=>({left:`${e}px`,top:`${t}px`}),parsePlacement=e=>{const[t,o]=e.split("-");return{position:t,align:o||"center"}},calculateContentAlignment=(e,t,o,n)=>"start"===e?t:"end"===e?t+o-n:t+(o-n)/2,calculateContentCoords=(e,t,o)=>{const{position:n,align:r}=parsePlacement(e),l=calculateContentAlignment(r,t.left,t.width,o.width),a=calculateContentAlignment(r,t.top,t.height,o.height);switch(n){case"top":return{x:l,y:t.top-o.height};case"left":return{y:a,x:t.left-o.width};case"right":return{y:a,x:t.right};case"bottom":default:return{x:l,y:t.bottom}}},calculateOffsetCoords=(e,t)=>{const{position:o}=parsePlacement(e),{main:n,cross:r}=(e=>Array.isArray(e)?{main:e[0],cross:e[1]}:{main:e,cross:0})(t);switch(o){case"left":return{y:r,x:-n};case"right":return{y:r,x:n};case"top":return{y:-n,x:r};case"bottom":default:return{y:n,x:r}}},calculateContentOverflow=(e,t,o)=>{const n=o.right,r=o.bottom,l=o.left,a=o.top;return{top:Math.max(a-e.y,0),bottom:Math.max(e.y+t.height-r,0),left:Math.max(l-e.x,0),right:Math.max(e.x+t.width-n,0)}},clamp=(e,t,o)=>Math.max(Math.min(t,o),e),usePopover=(a,c,i)=>{const s=(o=>{if(C()){const n=e(null);return t((()=>{n.value=o()})),n}return e(o())})((()=>document)),u=r((()=>{if(!s.value)return;const{root:e}=l(i);return e?s.value.querySelector(e):s.value.body})),{domRect:d}=useDomRect(a),{domRect:p}=useDomRect(c),updateContentCSS=()=>{var e;if(!u.value||!d.value||!p.value)return;let t={x:0,y:0};const o={width:"max-content",position:"fixed"},{placement:n,keepAnchorWidth:r,offset:a,autoPlacement:s,stickToEdges:m}=l(i);let h=calculateContentCoords(n,d.value,p.value);if(a&&(t=calculateOffsetCoords(n,a),h=mapObject(h,((e,o)=>e+t[o]))),r){const{width:e}=d.value;Object.assign(o,{width:`${e}px`,maxWidth:`${e}px`})}const v=u.value.getBoundingClientRect();if(s){const e=((e,t,o,n)=>{const{position:r,align:l}=parsePlacement(e),a=calculateContentOverflow(t,o,n),c={top:["bottom",l].join("-"),bottom:["top",l].join("-"),right:["left",l].join("-"),left:["right",l].join("-")};return a[r]?c[r]:e})(n,h,p.value,v);e!==n&&(h=calculateContentCoords(e,d.value,p.value),a&&(t=calculateOffsetCoords(e,a),h=mapObject(h,((e,o)=>e+t[o]))))}m&&(h=((e,t,o,n,r)=>{const{top:l,bottom:a,left:c,right:i}=calculateContentOverflow(e,o,r),s=e.x-i+c,u=e.y-a+l,{x:d,y:p}=t;return{x:clamp(n.left+d-o.width,s,n.right+d),y:clamp(n.top+p-o.height,u,n.bottom+p)}})(h,t,p.value,d.value,v)),Object.assign(null===(e=c.value)||void 0===e?void 0:e.style,{...o,...coordsToCss(h)})};return n(d,updateContentCSS),n(p,updateContentCSS),n(i,updateContentCSS,{deep:!0}),t((()=>{window.addEventListener("resize",updateContentCSS)})),o((()=>{window.removeEventListener("resize",updateContentCSS)})),{anchorDomRect:d,contentDomRect:p}},useDebounceFn=e=>{let t=null;const createDebounced=()=>x((()=>{null==t||t(),t=null}),l(e));let o=createDebounced();return a(e)&&n(e,(()=>{o=createDebounced()})),{debounced:e=>{t=e,o()},cancel:()=>o.cancel()}},checkIfElementChild=(e,t)=>!!t&&(t.parentElement===e||checkIfElementChild(e,t.parentElement)),useClickOutside=(e,n)=>{const clickHandler=t=>{const o=t.target;var r;(r=e,Array.isArray(r)?r:[r]).some((e=>l(e)&&checkIfElementChild(l(e),o)))||n(o)};t((()=>{window.addEventListener("click",clickHandler)})),o((()=>{window.removeEventListener("click",clickHandler)}))};var O=c({name:"VaDropdown",props:{...b,stateful:{default:!0},modelValue:{type:Boolean,default:!1},disabled:{type:Boolean},anchorSelector:{type:String,default:""},attachElement:{type:String,default:"body"},disableAttachment:{type:Boolean,default:!1},keepAnchorWidth:{type:Boolean,default:!1},isContentHoverable:{type:Boolean,default:!0},closeOnContentClick:{type:Boolean,default:!0},closeOnClickOutside:{type:Boolean,default:!0},closeOnAnchorClick:{type:Boolean,default:!0},hoverOverTimeout:{type:Number,default:30},hoverOutTimeout:{type:Number,default:200},offset:{type:[Array,Number],default:()=>0},trigger:{type:String,default:"click",validator:e=>["click","hover","none"].includes(e)},placement:{type:String,default:"bottom",validator:e=>A.includes(e)}},emits:[...k,"anchor-click","dropdown-content-click","click-outside"],setup(t,{emit:o}){const n=e(),l=e(),{valueComputed:a}=w(t,o),c=r((()=>({"va-dropdown":!0,"va-dropdown--disabled":t.disabled}))),s=r((()=>n.value&&t.anchorSelector&&n.value.querySelector(t.anchorSelector)||n.value));usePopover(s,l,r((()=>({placement:t.placement,keepAnchorWidth:t.keepAnchorWidth,offset:t.offset,stickToEdges:!0,autoPlacement:!0,root:t.attachElement}))));const{debounced:u,cancel:d}=useDebounceFn(i(t,"hoverOverTimeout")),{debounced:p,cancel:m}=useDebounceFn(i(t,"hoverOutTimeout")),emitAndClose=(e,t)=>{o(e),t&&(a.value=!1)};return useClickOutside([n,l],(()=>{t.closeOnClickOutside&&a.value&&emitAndClose("click-outside",t.closeOnClickOutside)})),{valueComputed:a,anchorRef:n,contentRef:l,computedClass:c,emitAndClose:emitAndClose,onAnchorClick:()=>{"click"!==t.trigger||t.disabled||(a.value?emitAndClose("anchor-click",t.closeOnAnchorClick):(a.value=!0,o("anchor-click")))},onMouseEnter:()=>{"hover"!==t.trigger||t.disabled||(u((()=>{a.value=!0})),m())},onMouseLeave:()=>{"hover"!==t.trigger||t.disabled||(t.isContentHoverable?p((()=>{a.value=!1})):a.value=!1,d())}}}});O.render=function render(e,t,o,n,r,l){return s(),u("div",{class:d(["va-dropdown",e.computedClass])},[p("div",{class:"va-dropdown__anchor",onClick:t[0]||(t[0]=t=>e.onAnchorClick()),onMouseenter:t[1]||(t[1]=t=>e.onMouseEnter()),onMouseleave:t[2]||(t[2]=t=>e.onMouseLeave()),onKeyup:t[3]||(t[3]=m(h((t=>e.onAnchorClick()),["stop","prevent"]),["enter"])),ref:"anchorRef"},[v(e.$slots,"anchor")],544),e.valueComputed?(s(),f(y,{key:0,to:e.attachElement,disabled:e.disableAttachment},[p("div",{class:"va-dropdown__content-wrapper",onMouseover:t[4]||(t[4]=t=>e.$props.isContentHoverable&&e.onMouseEnter()),onMouseout:t[5]||(t[5]=t=>e.onMouseLeave()),onClick:t[6]||(t[6]=h((t=>e.emitAndClose("dropdown-content-click",e.closeOnContentClick)),["stop"])),ref:"contentRef"},[v(e.$slots,"default")],544)],8,["to","disabled"])):g("v-if",!0)],2)},O.__file="src/components/va-dropdown/VaDropdown.vue";export{A as p,O as s};
//# sourceMappingURL=VaDropdown.mjs.map
