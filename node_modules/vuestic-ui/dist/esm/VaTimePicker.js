import{toRefs as e,ref as t,watch as l,computed as a,defineComponent as u,onMounted as r,nextTick as o,openBlock as s,createElementBlock as n,withKeys as i,withModifiers as v,Fragment as m,renderList as c,normalizeClass as d,renderSlot as p,normalizeProps as f,guardReactiveProps as I,createTextVNode as k,toDisplayString as h,createElementVNode as x,resolveComponent as y,createBlock as b}from"vue";import{u as C}from"./useSyncProp.js";import{a as g,u as F}from"./useFocus.js";import{a as P,u as w,b as N}from"./useStateful.js";import{u as A,a as T}from"./useForm.js";import{u as M}from"./useArrayRefs.js";const safeModelValue=e=>e.value?e.value:new Date((new Date).setHours(0,0,0,0)),createNumbersArray=e=>Array.from(Array(e).keys()),from24to12=e=>(0===e?12:e)-12*Number(e>12),createHoursColumn=(e,t,l)=>{const u=a((()=>e.ampm?12:24)),r=a((()=>{let t=createNumbersArray(u.value);return e.hoursFilter&&(t=t.filter((t=>e.hoursFilter(e.ampm?t+12*Number(l.value):t)))),t.map((t=>e.ampm?from24to12(t):t))})),o=a({get:()=>{if(!t.value)return-1;if(e.ampm){const e=from24to12(t.value.getHours()-12*Number(l.value));return r.value.findIndex((t=>t===e))}const a=t.value.getHours();return r.value.findIndex((e=>e===a))},set:a=>{if(e.readonly)return;const u=e.ampm?((e,t=!1)=>(12===e?0:e)+12*Number(t))(r.value[a],l.value):r.value[a];t.value=new Date(safeModelValue(t).setHours(u))}});return a((()=>({items:r.value,activeItem:o})))},useTimePicker=(u,r)=>{const{view:o}=e(u),s=t(!1);l(r,(()=>{s.value=safeModelValue(r).getHours()>=12}),{immediate:!0});const n=createHoursColumn(u,r,s),i=((e,t)=>{const l=a((()=>{const t=createNumbersArray(60);return e.minutesFilter?t.filter(e.minutesFilter):t})),u=a({get:()=>{if(!t.value)return-1;const e=t.value.getMinutes();return l.value.findIndex((t=>t===e))},set:a=>{if(e.readonly)return;const u=l.value[a];t.value=new Date(safeModelValue(t).setMinutes(u))}});return a((()=>({items:l.value,activeItem:u})))})(u,r),v=((e,t)=>{const l=a((()=>{const t=createNumbersArray(60);return e.secondsFilter?t.filter(e.secondsFilter):t})),u=a({get:()=>{if(!t.value)return-1;const e=t.value.getSeconds();return l.value.findIndex((t=>t===e))},set:a=>{if(e.readonly)return;const u=l.value[a];t.value=new Date(safeModelValue(t).setSeconds(u))}});return a((()=>({items:l.value,activeItem:u})))})(u,r),m=((e,t,l)=>a((()=>({items:["AM","PM"],activeItem:a({get:()=>t.value?Number(l.value):-1,set:a=>{l.value=Boolean(a);const u=safeModelValue(t).getHours();let r=l.value?u+12:u;l.value&&u<=12&&(r=u+12),!l.value&&u>=12&&(r=u-12);const o=!e.hoursFilter||e.hoursFilter(r);e.periodUpdatesModelValue&&o&&(t.value=new Date(safeModelValue(t).setHours(r)))}})}))))(u,r,s);return{columns:a((()=>{const e=[];return"hours"===o.value?e.push(n.value):"minutes"===o.value?e.push(n.value,i.value):"seconds"===o.value&&e.push(n.value,i.value,v.value),u.ampm&&!u.hidePeriodSwitch&&e.push(m.value),e})),isPM:s}};var V=u({name:"VaTimePickerColumn",props:{items:{type:Array,default:()=>[]},activeItemIndex:{type:Number,default:0}},emits:["item-selected","update:activeItemIndex",...g],setup(e,{emit:a}){const u=t();F(u,a);const[s]=C("activeItemIndex",e,a);l(s,(e=>{scrollTo(e)})),r((()=>scrollTo(s.value,!1)));const scrollTo=(e,t=!0)=>{o((()=>{var l,a;const r=u.value.children[e];r?null===(a=u.value)||void 0===a||a.scrollTo({behavior:t?"smooth":"auto",top:r.offsetTop-r.parentElement.offsetTop}):null===(l=u.value)||void 0===l||l.scrollTo({behavior:t?"smooth":"auto",top:0})}))};return{rootElement:u,makeActiveNext:t=>{s.value=(s.value+(t||1))%e.items.length,o((()=>scrollTo(s.value)))},makeActivePrev:t=>{s.value=(s.value-(t||1)+e.items.length)%e.items.length,o((()=>scrollTo(s.value)))},makeActiveByIndex:e=>{s.value=e,o((()=>scrollTo(s.value)))},onCellClick:e=>{s.value=e},formatCell:e=>Number.isInteger(e)?e<10?`0${e}`:`${e}`:e}},methods:{focus(){var e;null===(e=this.rootElement)||void 0===e||e.focus()},blur(){var e;null===(e=this.rootElement)||void 0===e||e.blur()}}});const D=x("div",{class:"va-time-picker-cell va-time-picker-cell--fake"},null,-1),H=["onClick"],S=x("div",{class:"va-time-picker-cell va-time-picker-cell--fake"},null,-1);V.render=function render$1(e,t,l,a,u,r){return s(),n("div",{tabindex:"0",class:"va-time-picker-column",onKeydown:[t[0]||(t[0]=i(v((t=>e.makeActiveNext()),["stop","prevent"]),["down"])),t[1]||(t[1]=i(v((t=>e.makeActiveNext(5)),["stop","prevent"]),["space"])),t[2]||(t[2]=i(v((t=>e.makeActivePrev()),["stop","prevent"]),["up"]))],ref:"rootElement"},[D,(s(!0),n(m,null,c(e.items,((t,l)=>(s(),n("div",{key:t,class:d({"va-time-picker-cell":!0,"va-time-picker-cell--active":l===e.$props.activeItemIndex}),onClick:t=>e.onCellClick(l)},[p(e.$slots,"cell",f(I({item:t,index:l,activeItemIndex:e.activeItemIndex,items:e.items,formattedItem:e.formatCell(t)})),(()=>[k(h(e.formatCell(t)),1)]))],10,H)))),128)),S],544)},V.__file="src/components/va-time-picker/components/VaTimePickerColumn.vue";var E=u({name:"VaTimePicker",components:{VaTimePickerColumn:V},props:{...P,...A,modelValue:{type:Date,required:!1},ampm:{type:Boolean,default:!1},hidePeriodSwitch:{type:Boolean,default:!1},periodUpdatesModelValue:{type:Boolean,default:!0},view:{type:String,default:"minutes"},hoursFilter:{type:Function},minutesFilter:{type:Function},secondsFilter:{type:Function}},emits:w,setup(e,{emit:l}){const{valueComputed:a}=N(e,l),{columns:u,isPM:r}=useTimePicker(e,a),{setItemRef:o,itemRefs:s}=M(),n=t(),focus=(e=0)=>{var t;null===(t=s.value[e])||void 0===t||t.focus()},{createComputedClass:i}=T(e);return{columns:u,computedClass:i("va-time-picker"),isPM:r,pickers:s,setItemRef:o,focusNext:()=>{const e=((null==n?void 0:n.value)||0)+1;n.value=e%u.value.length,focus(n.value)},focusPrev:()=>{const e=((null==n?void 0:n.value)||0)-1+u.value.length;n.value=e%u.value.length,focus(n.value)},activeColumnIndex:n,focus:focus,blur:e=>{var t;e?null===(t=s.value[e])||void 0===t||t.blur():s.value.forEach((e=>null==e?void 0:e.blur()))}}}});E.render=function render(e,t,l,a,u,r){const o=y("VaTimePickerColumn");return s(),n("div",{class:d(["va-time-picker",e.computedClass])},[(s(!0),n(m,null,c(e.columns,((l,a)=>(s(),b(o,{key:a,ref:e.setItemRef,items:l.items,tabindex:e.disabled?-1:0,activeItemIndex:l.activeItem.value,"onUpdate:activeItemIndex":e=>l.activeItem.value=e,onKeydown:[t[0]||(t[0]=i(v((t=>e.focusNext()),["stop","prevent"]),["right"])),t[1]||(t[1]=i(v((t=>e.focusNext()),["exact","stop","prevent"]),["tab"])),t[2]||(t[2]=i(v((t=>e.focusPrev()),["stop","prevent"]),["left"])),t[3]||(t[3]=i(v((t=>e.focusPrev()),["shift","stop","prevent"]),["tab"]))],onFocus:t=>e.activeColumnIndex=a},null,8,["items","tabindex","activeItemIndex","onUpdate:activeItemIndex","onFocus"])))),128))],2)},E.__file="src/components/va-time-picker/VaTimePicker.vue";export{E as s};
//# sourceMappingURL=VaTimePicker.js.map
