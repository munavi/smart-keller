import{w as e}from"./withConfigTransport.js";import{a as l}from"./debounce.js";import{onMounted as r,onBeforeUnmount as o,defineComponent as t,ref as s,computed as i,watch as a,resolveComponent as n,openBlock as u,createBlock as v,resolveDynamicComponent as c,normalizeClass as d,withCtx as p,renderSlot as f,createElementVNode as m,createVNode as g,createCommentVNode as b}from"vue";import{s as h}from"./utils.js";import{a as y}from"./useColor.js";import{VaProgressCircle as S}from"./index39.js";import"./VaConfig.js";import"./global-config.js";import"./toNumber.js";import"./isSymbol.js";import"./color-config.js";import"colortranslator";import"./clamp.js";import"./useSize.js";var j=t({name:"VaInfiniteScroll",components:{VaProgressCircle:S},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:String,default:null},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:t}){const n=s(),u=s(),v=s(!1),c=s(!1),d=s(!1),p=s(),f=s(0),m=s(0),g=i((()=>{var l;let r;return r="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(l=n.value)||void 0===l?void 0:l.parentElement),r||document.body})),{addScrollListener:b,removeScrollListener:S}=((e,l,t)=>{const addScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.addEventListener("scroll",t.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.removeEventListener("scroll",t.value)};return r((()=>{l.value&&(l.value.style.overflowY="scroll",e.reverse&&(l.value.scrollTop=l.value.scrollHeight),addScrollListener())})),o(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,g,p),{computeColor:j}=y(e),_=i((()=>c.value?j("danger"):j("primary"))),C=i((()=>{var e;return(null===(e=u.value)||void 0===e?void 0:e.offsetHeight)||0})),T=i((()=>e.offset+C.value)),stop=()=>{e.disabled||(v.value=!1,S())},resume=()=>{e.disabled||b()},onLoad=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=g.value;f.value=r-l;const t=l-m.value;if(m.value=l,e.disabled||c.value||v.value)return;if(d.value)return void(d.value=!1);if(e.reverse&&t>0||!e.reverse&&t<0)return;(e.reverse?l:r-l-o)>T.value||(v.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{d.value=!0,g.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=g.value;if(e.reverse){const e=r-l<f.value,o=l>=C.value;if(e&&o)return;r-f.value>C.value?forceSetScrollTopToTarget(r-f.value):forceSetScrollTopToTarget(C.value)}if(!e.reverse){!(r-l-o>=C.value)&&forceSetScrollTopToTarget(r-o-C.value)}},finishLoading=()=>{updateTargetElementScrollTop(),v.value=!1,t("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),d.value=!1,c.value=!1,v.value=!1,t("onerror")},onError=()=>{stop(),c.value=!0,h(1200).then(stopErrorDisplay).then(resume)};return a((()=>e.debounce),(e=>{p.value=l(onLoad,e)}),{immediate:!0}),a((()=>e.disabled),(e=>{e?stop():resume()})),{element:n,spinnerSlotContainer:u,spinnerColor:_,fetching:v}}});const _={class:"va-infinite-scroll__spinner__default"};j.render=function render(e,l,r,o,t,s){const i=n("va-progress-circle");return u(),v(c(e.$props.tag),{class:d(["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}]),ref:"element"},{default:p((()=>[f(e.$slots,"default"),m("div",{class:d(["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}]),ref:"spinnerSlotContainer"},[e.$props.disabled?b("v-if",!0):f(e.$slots,"loading",{key:0},(()=>[m("div",_,[g(i,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)])),_:3},8,["class"])},j.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";var C=e(j);export{C as default};
//# sourceMappingURL=index51.js.map
